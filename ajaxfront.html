<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Accommodation</title>
	<link rel="stylesheet" type="text/css" href="main.css" />
	<link rel="stylesheet" type="text/css" href="jquery-ui-css.css" />
	<script type='text/javascript' src='jquery.js'></script>
	<script type='text/javascript' src='jquery-ui.js'></script>

	<script type='text/javascript'>
	$(document).ready(onLoad);

	function onLoad(){
		$("#startdate").datepicker({ dateFormat: 'yy/mm/dd' });
		$("#enddate").datepicker({ dateFormat: 'yy/mm/dd' });
	}

	function fontSize(s){
		var currentFontSize = $('html').css('font-size');
		var currentFontSizeNum = parseFloat(currentFontSize, 10);
		if(s == "u")
		{		
			var fontPlus = currentFontSizeNum*1.2;
			$("html").css('font-size', fontPlus);
		}
		else if(s == "d")
		{
			var fontMinus = currentFontSizeNum*0.8;
			$("html").css('font-size', fontMinus);
		}
	}

	function resultsCustomise(){
		var bgCol = $("#searchbg").val();
		var textCol = $("#searchtext").val();
		if(bgCol == '' && textCol != ''){ $("#searchaccomresponse").css({color: textCol}); }
		else if(textCol == '' && bgCol != ''){ $("#searchaccomresponse").css({backgroundColor: bgCol}); }
		else if(bgCol != '' && textCol != ''){ $("#searchaccomresponse").css({backgroundColor: bgCol, color: textCol}); }
	}

	function ajaxsearch()
	{
		var l = $("#location").val();
		var t = $("#type").val();
	
		var searchrequest = $.ajax({
                url: 'searchscript.php',
                type: 'GET',
                dataType: 'json',
                data: {location: l, type: t},
                success: searchReceived,
                error: searchError
            });
	}

	function ajaxreview()
	{
		var id = $("#accidreview").val();
		var r = $("#review").val();
	
		var reviewrequest = $.ajax({
                url: 'addreview.php',
                type: 'PUT',
                data: {accid: id, review: r},
                success: reviewReceived,
                error: reviewError
            });
	}

	function ajaxbook()
	{
		var bookid = $("#accidbook").val();
		var sd = $("#startdate").val();
		var ed = $("#enddate").val();
		var r = $("#room").val();
	
		var reviewrequest = $.ajax({
                url: 'bookroom.php',
                type: 'PUT',
                data: {accidbook: bookid, startdate: sd, enddate: ed, room: r},
                success: bookReceived,
                error: bookError
            });
	}

	function searchError(jqXHR, textStatus, errorThrown)
	{
		if(errorThrown == "Location_Missing"){
			$("#searchaccomresponse").html("Please enter a location.");
		}
		else if(errorThrown == "No Accommodation Found"){
			$("#searchaccomresponse").html("No accommodation found in that location.");
		}
		else if(errorThrown == "Unauthorized Access"){
			$("#searchaccomresponse").html("Unauthorised access.");
		}
	}

	function searchReceived(response)
	{
		$("#searchaccomresponse").html("");
		//add headings to table: id name type etc
		$("#searchaccomresponse").append("<table>");
		for(var i=0; i<response.length; i++){
			$("#searchaccomresponse").append("<tr><td>"+response[i].name+"</td>"+
				"<td>"+response[i].type+"</td>"+
				"<td>"+response[i].location+"</td>"+
				"<td>"+response[i].latitude+"</td>"+
				"<td>"+response[i].longitude+"</td>"+
				"<td>"+response[i].availability+"</td>"+
				"</tr>");
		}
		$("#searchaccomresponse").append("</table>");
	}

	function reviewError(jqXHR, textStatus, errorThrown)
	{	
		if(errorThrown == "Missing Fields"){
			$("#searchaccomresponse").html("Please enter an accommodation ID.");
		}
		else if(errorThrown == "No Accommodation Found"){
			$("#searchaccomresponse").html("No accommodation found in that location.");
		}
		else if(errorThrown == "Unauthorized Access"){
			$("#searchaccomresponse").html("Unauthorised access.");
		}
	}

	function reviewReceived(response)
	{
		$("#searchaccomresponse").html("Review Added.");
		$("#book").val("");
		$("#review").val("");
	}

	function bookError(jqXHR, textStatus, errorThrown)
	{	
		if(errorThrown == "Missing Fields"){
			$("#searchaccomresponse").html("Please enter an accommodation ID.");
		}
		else if(errorThrown == "No Accommodation Found"){
			$("#searchaccomresponse").html("No accommodation found with that ID.");
		}
		else if(errorThrown == "Unauthorized Access"){
			$("#searchaccomresponse").html("Unauthorised access.");
		}
	}

	function bookReceived(response)
	{
		$("#searchaccomresponse").html("Booking Added.");
		$("#accidbook").val("");
		$("#startdate").val("");
		$("#enddate").val("");
		$("#room").val("");
	}
	</script>
</head>

<body>
	<div id="container">
		<div id="logo"><img src="images/logo.png" alt="logo"/></div>

		<div id="navigation">
			<ul>
				<li><a href="index.php">Home</a></li>
			</ul>
		</div>

		<div id="stage">
			<div id="left">
				<table>
				<tr><td> Location: </td> <td><input type="text" id="location" name="location"/></td></tr>
				<tr><td> Type: </td> <td><input type="text" id="type" name="type"/></td</tr>
				<tr><td> <button onclick="ajaxsearch()">Search</button> </td></tr>
				</table><br /><br />


				<table>
				<tr><td> Accommodation ID: </td> <td><input type="text" id="accidreview" name="accidreview"/></td></tr>
				<tr><td> Review: </td> <td><input type="text" id="review" name="review"/></td</tr>
				<tr><td> <button onclick="ajaxreview()">Add Review</button> </td></tr>
				</table><br /><br />

				<table>
				<tr><td> Accommodation ID: </td> <td><input type="text" id="accidbook" name="accidbook"/></td></tr>
				<tr><td> Start Date: </td> <td><input type="text" name="startdate" id="startdate"/></td></tr>
				<tr><td> End Date: </td> <td><input type="text" name="enddate" id="enddate"/></td></tr>
				<tr><td> Room: </td> <td><input type="text" id="room" name="room"/></td></tr>
				<tr><td> <button onclick="ajaxbook()">Make Booking</button> </td></tr>
				</table>
			</div>


			<div id="middle">
				<div id="searchaccomresponse"></div>
			</div>

			<div id="right">
				<div id="buttonDiv">
					Background:<br />
					<input id="searchbg" size="10"/><br />
					Text:<br />
					<input id="searchtext" size="10"/><br />
					<button onclick="resultsCustomise()">Change</button><br />

					Font Size:<br />
					<button onclick="fontSize('u')">Increase</button>
					<button onclick="fontSize('d')">Decrease</button>
				</div>
			</div>
			
		</div>
	</div>
	
</body>
</html>